<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elks Riders #2524 Leather Koozie Order Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;          /* dark blue-black page background */
      --card: #ffffff;
      --accent: #2563eb;      /* link-style blue */
      --accent-light: #60a5fa;
      --border: #e5e7eb;
      --text: #0f172a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
      color: var(--text);
    }

    .page {
      max-width: 900px;
      margin: 2.5rem auto;
      padding: 0 1rem 2.5rem;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 2rem 1.75rem 2.25rem;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.55);
      border: 1px solid #cbd5f5;
    }

    header {
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 1rem;
      margin-bottom: 1.25rem;
    }

    h1, h2, h3 {
      margin-top: 0;
      font-weight: 650;
      color: var(--accent);
    }

    h1 {
      font-size: 2rem;
      letter-spacing: 0.02em;
      margin-bottom: 0.4rem;
    }

    h2 {
      font-size: 1.25rem;
      margin-top: 1.75rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.3rem;
      border-bottom: 1px solid #e5e7eb;
    }

    p {
      line-height: 1.6;
      margin-top: 0.3rem;
      margin-bottom: 0.75rem;
      color: #111827;
    }

    .subtle {
      font-size: 0.9rem;
      color: #4b5563;
    }

    .highlight {
      background: linear-gradient(135deg, #1d4ed8, #2563eb);
      border-left: 4px solid var(--accent-light);
      padding: 0.9rem 1.1rem;
      border-radius: 10px;
      margin: 1rem 0 1.1rem;
      font-size: 0.95rem;
      color: #ffffff;
    }

    .highlight strong {
      color: #e5e7eb;
    }

    form {
      margin-top: 1rem;
    }

    .grid-2 {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
      font-weight: 550;
      color: #0f172a;
    }

    input[type="text"],
    input[type="number"],
    input[type="email"],
    textarea,
    select {
      width: 100%;
      padding: 0.5rem 0.6rem;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease;
      background-color: #f9fafb;
      color: var(--text);
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent-light);
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
      background-color: #ffffff;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .checkbox-row,
    .inline-row {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      flex-wrap: wrap;
      margin-bottom: 0.4rem;
    }

    input[type="checkbox"],
    input[type="radio"] {
      width: auto;
      accent-color: var(--accent);
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 1.25rem;
      margin-bottom: 0.5rem;
    }

    .badge {
      font-size: 0.78rem;
      background: #eff6ff;
      color: #1d4ed8;
      padding: 0.1rem 0.55rem;
      border-radius: 999px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      border: 1px solid #bfdbfe;
    }

    .koozie-list {
      margin-top: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .koozie-item {
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 0.9rem 0.9rem 0.75rem;
      background: #f9fafb;
      position: relative;
    }

    .koozie-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .koozie-title {
      font-size: 0.98rem;
      font-weight: 600;
      color: #111827;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      border: 1px solid transparent;
      background: var(--accent);
      color: #ffffff;
      font-size: 0.95rem;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease;
    }

    .btn:hover {
      background: #1d4ed8;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-outline {
      background: #ffffff;
      color: #000000;
      border-color: #9ca3af;
      font-weight: 500;
    }

    .btn-outline:hover {
      background: #f3f4f6;
      color: #111827;
      border-color: #6b7280;
    }

    .btn-small {
      padding: 0.25rem 0.7rem;
      font-size: 0.82rem;
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1.25rem;
      align-items: flex-start;
      justify-content: space-between;
    }

    .totals {
      font-size: 0.93rem;
      line-height: 1.5;
      background: #f9fafb;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 0.85rem 1rem;
      margin-top: 0.3rem;
    }

    .totals-row {
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 0.15rem;
    }

    .totals strong {
      font-weight: 600;
      color: var(--accent);
    }

    .totals-label {
      color: #374151;
    }

    .totals-value {
      font-variant-numeric: tabular-nums;
      color: #111827;
    }

    .footer-text {
      margin-top: 1.3rem;
      font-size: 0.85rem;
      color: #4b5563;
    }

    .footer-text span {
      font-weight: 600;
      color: var(--accent);
    }

    .preview-box {
      margin-top: 1rem;
      background: #0f172a;
      border-radius: 10px;
      padding: 0.8rem 1rem;
      border: 1px solid #1f2937;
      color: #ffffff;
    }

    .preview-box label {
      color: #e5e7eb;
      margin-bottom: 0.35rem;
      display: block;
    }

    .preview-box textarea {
      font-family: monospace;
      font-size: 0.85rem;
      background: transparent;
      border: none;
      padding: 0;
      min-height: 130px;
      color: #e5e7eb;
      width: 100%;
    }

    .koozie-photos {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 0.5rem;
      margin-bottom: 1.25rem;
      justify-content: center;
    }

    .koozie-photos img {
      border-radius: 8px;
      border: 1px solid var(--border);
      max-width: 30%;
      height: auto;
      object-fit: cover;
      box-shadow: 0 4px 12px rgba(0,0,0,0.35);
      background: #111827;
    }

    @media (max-width: 640px) {
      .card {
        padding: 1.5rem 1rem 1.8rem;
      }
      .actions-row {
        flex-direction: column;
        align-items: stretch;
      }
      .actions-row > div {
        width: 100%;
      }
      .btn {
        justify-content: center;
        width: 100%;
      }
      .koozie-photos img {
        max-width: 100%;
      }
      .totals-row {
        flex-direction: row;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <header>
        <h1>Elks Riders Leather “Biker Vest” Koozie Order Form</h1>
        <p>
          Natural leather koozies, engraved and cut on a CNC laser table, hand finished with metal grommets, rivets, oil,
          and leather lacing down both sides. Designed to look like Elks Riders vests.
        </p>
        <div class="highlight">
          <strong>$10 from every koozie sold is donated to Forks Elks Riders #2524</strong>, helping support local charity work,
          group activities, and community service projects. .
        </div>

        <p class="subtle">
          When you submit this form, your email program will open with all order details filled in and addressed to
          <strong>pnw.klown@gmail.com</strong>.<br />
          Flat-rate <strong>$5 shipping</strong> is available anywhere in the U.S.
          for up to <strong>10 koozies per order</strong>.
          <br />
          You will receive a <strong>PayPal invoice</strong> once your order is ready to begin. Please <strong>do not send any payment</strong>
          until you receive that invoice. If you have not received an invoice within two weeks, please email
          <strong>pnw.klown@gmail.com</strong> to request an update on the status of your order.
        </p>
      </header>

      <form id="order-form">
        <h2>Sample Koozie Photos</h2>
        <div class="koozie-photos">
          <img src="koozie-back.jpg" alt="Back of the Elks Riders leather koozie" />
          <img src="koozie-front.jpg" alt="Front of the Elks Riders leather koozie" />
          <img src="koozie-on-can.jpg" alt="Elks Riders leather koozie shown on a can" />
        </div>

        <!-- CUSTOMER INFO -->
        <h2>Customer & Shipping Details</h2>
        <div class="grid-2">
          <div>
            <label for="customer-name">Your full name (person placing this order) *</label>
            <input type="text" id="customer-name" required />
          </div>
          <div>
            <label for="customer-email">Email (for confirmation) *</label>
            <input type="email" id="customer-email" required />
          </div>
          <div>
            <label for="customer-phone">Phone (optional)</label>
            <input type="text" id="customer-phone" />
          </div>
          <div>
            <label for="home-lodge-number">Your Home Elks Lodge Name & Number</label>
            <input type="text" id="home-lodge-number" placeholder="e.g. Forks 2524" />
          </div>
        </div>

        <div class="grid-2" style="margin-top: 0.75rem;">
          <div>
            <label for="shipping-address">Shipping address (for USPS flat-rate)</label>
            <textarea id="shipping-address" placeholder="Street, City, State, ZIP"></textarea>
          </div>
          <div>
            <label>Shipping *</label>
            <div class="checkbox-row">
              <label class="inline-row">
                <input type="radio" name="shipping-option" value="ship" checked />
                <span>Ship my order (adds $5 flat-rate per order, up to 10 koozies)</span>
              </label>
            </div>
            <div class="checkbox-row">
              <label class="inline-row">
                <input type="radio" name="shipping-option" value="pickup" />
                <span>Local pickup / arrange directly with the order coordinator (no shipping charge)</span>
              </label>
            </div>
            <p class="subtle" style="margin-top: 0.5rem;">
              Shipped orders include a PayPal processing fee of <strong>2.9% + $0.30</strong> in the total above.
              Local pickup orders may be paid in cash and do not include this fee.
            </p>
          </div>
        </div>

        <p class="subtle" style="margin-top: 0.5rem;">
          All information you provide is kept private and will never be shared or sold. You will only be contacted
          regarding communication about this order.
        </p>

        <!-- KOOZIE ITEMS -->
        <div class="section-header">
          <h2>Koozie Personalization</h2>
          <span class="badge">Each one can be unique</span>
        </div>
        <p class="subtle">
          Add a separate entry for each koozie. Each koozie will have personalized <strong>Road Name</strong>, <strong>Lodge Number</strong>,
          <strong>Officer Title</strong>, and <strong>Founding Member</strong> "patches" as requested. The back "patch" will also display the Lodge Number.
          If you need more than <strong>10 koozies</strong>, please submit an additional order form for the extra items.
        </p>

        <div class="koozie-list" id="koozie-list">
          <!-- Koozies are injected here by JS -->
        </div>

        <button type="button" class="btn btn-small" id="add-koozie-btn">
          + Add another koozie (max 10 per order)
        </button>

        <!-- ORDER SUMMARY -->
        <h2>Order Summary</h2>

        <!-- Donation info moved OUTSIDE the calculations -->
        <div class="subtle" style="margin-bottom: 0.5rem;">
          <strong>Note:</strong> $10 from each koozie is donated to Forks Elks Riders #2524.
          Estimated donation for this order: <strong>$<span id="summary-donation">0.00</span></strong>.
          This donation is included in the koozie price and is not treated as a separate line in the invoice.
        </div>

        <hr style="border: none; border-top: 1px solid #e5e7eb; margin: 0.75rem 0 0.75rem;" />

        <div class="totals" id="totals">
          <div class="totals-row">
            <div class="totals-label"><strong>Quantity:</strong></div>
            <div class="totals-value"><span id="summary-qty">0</span> koozie(s)</div>
          </div>

          <div class="totals-row">
            <div class="totals-label"><strong>Subtotal (@ $35 each):</strong></div>
            <div class="totals-value">$<span id="summary-subtotal">0.00</span></div>
          </div>

          <div class="totals-row">
            <div class="totals-label"><strong>Shipping:</strong></div>
            <div class="totals-value">$<span id="summary-shipping">0.00</span></div>
          </div>

          <div class="totals-row">
            <div class="totals-label"><strong>Washington sales tax (items + shipping):</strong></div>
            <div class="totals-value">$<span id="summary-tax">0.00</span></div>
          </div>

          <div class="totals-row">
            <div class="totals-label">
              <strong>PayPal fee (shipped orders only):</strong><br />
              <span class="subtle">(not subject to sales tax)</span>
            </div>
            <div class="totals-value">$<span id="summary-paypal">0.00</span></div>
          </div>

          <div class="totals-row" style="margin-top: 0.4rem;">
            <div class="totals-label"><strong>Total amount to be invoiced:</strong></div>
            <div class="totals-value"><strong>$<span id="summary-total">0.00</span></strong></div>
          </div>
        </div>

        <!-- PREVIEW (for copying if email client has issues) -->
        <div class="preview-box">
          <label for="preview-text" class="subtle">
            Order email preview (if your email program doesn’t open, you can copy/paste this into a new email).
          </label>
          <textarea id="preview-text" readonly></textarea>
        </div>

        <!-- ACTIONS -->
        <div class="actions-row">
          <div>
            <button type="submit" class="btn">
              Open Email with My Order
            </button>
          </div>
          <div class="subtle">
            After your email opens:<br />
            1) Review the details and click <strong>Send</strong>.<br />
            2) Once your order is ready to begin, you will receive a <strong>PayPal invoice</strong> for the total amount.
          </div>
        </div>

        <p class="footer-text">
          <span>Note:</span> This site does not process online payments. Orders are completed by emailing your details.
          Payment is made only after you receive a PayPal invoice. Your contact information is used solely
          for communication about this order and is never shared or sold. None of your information is saved on this site; this is
          only a utility designed to form an email with a uniform layout to assist in ordering.
          Washington sales tax is applied to the item price and shipping, but not to any PayPal processing fees.
          Pricing may vary depending on changes in material costs, supply availability, or additional labor required to complete orders.
          Orders are not considered accepted, and production will not begin, until a PayPal invoice has been sent and payment has been received.
          All orders are processed on a first-come, first-served basis, and completion times may vary depending on current demand.
        </p>
      </form>
    </div>
  </div>

  <!-- TEMPLATE FOR KOOZIE ITEM -->
  <template id="koozie-template">
    <div class="koozie-item">
      <div class="koozie-title-row">
        <div class="koozie-title">Koozie #<span class="koozie-number"></span></div>
        <button type="button" class="btn btn-outline btn-small remove-koozie-btn">Remove</button>
      </div>

      <div class="grid-2">
        <div>
          <label>Lodge number *</label>
          <input type="text" class="koozie-lodge" placeholder="e.g. 2524" required />
        </div>
        <div>
          <label>Road name on this koozie *</label>
          <input type="text" class="koozie-road-name" placeholder='e.g. “KLOWN”' required />
        </div>
      </div>

      <div class="grid-2" style="margin-top: 0.5rem;">
        <div>
          <label>Officer title</label>
          <select class="koozie-officer">
            <option value="">None</option>
            <option value="President">President</option>
            <option value="Vice President">Vice President</option>
            <option value="Sergeant At Arms">Sergeant At Arms</option>
            <option value="Financial Secretary">Financial Secretary</option>
            <option value="Road Captain">Road Captain</option>
            <option value="Chaplain">Chaplain</option>
            <option value="Other">Other (type below)</option>
          </select>
        </div>
        <div>
          <label>Custom officer title (if “Other”)</label>
          <input type="text" class="koozie-officer-custom" placeholder="e.g. Chaplain, Tailgunner" />
        </div>
      </div>

      <div style="margin-top: 0.4rem;">
        <div class="checkbox-row">
          <label class="inline-row">
            <input type="checkbox" class="koozie-founding" />
            <span>Show “Founding Member” on this koozie</span>
          </label>
        </div>
      </div>
    </div>
  </template>

  <script>
    (function () {
      const PRICE_PER_KOOZIE = 35;
      const DONATION_PER_KOOZIE = 10;
      const SHIPPING_FLAT = 5;        // flat USPS shipping
      const PAYPAL_PERCENT = 0.029;   // 2.9%
      const PAYPAL_FIXED = 0.30;      // $0.30 per order
      const SALES_TAX_RATE = 0.084;   // 8.4% combined sales tax (items + shipping, not PayPal)
      const MAX_KOOZIES = 10;
      const ORDER_EMAIL = "pnw.klown@gmail.com";

      const koozieList = document.getElementById("koozie-list");
      const koozieTemplate = document.getElementById("koozie-template");
      const addKoozieBtn = document.getElementById("add-koozie-btn");

      const qtyEl = document.getElementById("summary-qty");
      const subtotalEl = document.getElementById("summary-subtotal");
      const donationEl = document.getElementById("summary-donation");
      const shippingEl = document.getElementById("summary-shipping");
      const taxEl = document.getElementById("summary-tax");
      const paypalEl = document.getElementById("summary-paypal");
      const totalEl = document.getElementById("summary-total");

      const previewText = document.getElementById("preview-text");
      const form = document.getElementById("order-form");

      let koozieCount = 0;

      function addKoozie() {
        if (koozieList.children.length >= MAX_KOOZIES) {
          alert("Maximum of " + MAX_KOOZIES + " koozies per order. For more, please submit an additional order form or contact the order coordinator.");
          return;
        }

        koozieCount++;
        const clone = koozieTemplate.content.cloneNode(true);
        const item = clone.querySelector(".koozie-item");
        item.dataset.index = koozieCount;
        item.querySelector(".koozie-number").textContent = koozieCount;

        const removeBtn = item.querySelector(".remove-koozie-btn");
        removeBtn.addEventListener("click", () => {
          if (koozieList.children.length === 1) {
            alert("You must have at least one koozie in the order.");
            return;
          }
          item.remove();
          renumberKoozies();
          updateTotalsAndPreview();
        });

        const officerSelect = item.querySelector(".koozie-officer");
        const customInput = item.querySelector(".koozie-officer-custom");
        officerSelect.addEventListener("change", () => {
          if (officerSelect.value === "Other") {
            customInput.focus();
          }
          updateTotalsAndPreview();
        });

        // Update preview when any field in this koozie changes
        item.addEventListener("input", updateTotalsAndPreview);
        koozieList.appendChild(clone);
        renumberKoozies();
        updateTotalsAndPreview();
      }

      function renumberKoozies() {
        Array.from(koozieList.children).forEach((item, index) => {
          item.dataset.index = index + 1;
          const numSpan = item.querySelector(".koozie-number");
          if (numSpan) numSpan.textContent = index + 1;
        });
      }

      function getKoozieData() {
        const items = [];
        Array.from(koozieList.children).forEach((item) => {
          const lodge = item.querySelector(".koozie-lodge").value.trim();
          const roadName = item.querySelector(".koozie-road-name").value.trim();
          const officer = item.querySelector(".koozie-officer").value;
          const officerCustom = item.querySelector(".koozie-officer-custom").value.trim();
          const founding = item.querySelector(".koozie-founding").checked;

          items.push({
            lodge,
            roadName,
            officer,
            officerCustom,
            founding,
          });
        });
        return items;
      }

      function updateTotalsAndPreview() {
        const items = getKoozieData();
        const qty = items.length;
        const subtotal = qty * PRICE_PER_KOOZIE;
        const donation = qty * DONATION_PER_KOOZIE;

        const shippingOption = document.querySelector('input[name="shipping-option"]:checked')?.value || "ship";
        let shipping = 0;
        if (shippingOption === "ship" && qty > 0) {
          shipping = SHIPPING_FLAT;
        }

        // Tax is applied to items + shipping (not PayPal fee)
        const taxableAmount = subtotal + shipping;
        const salesTax = taxableAmount > 0 ? taxableAmount * SALES_TAX_RATE : 0;

        // PayPal fee: applies ONLY to shipped orders, not taxed
        let paypalFee = 0;
        if (shippingOption === "ship" && qty > 0) {
          paypalFee = subtotal * PAYPAL_PERCENT + PAYPAL_FIXED;
        }

        const total = subtotal + shipping + salesTax + paypalFee;

        qtyEl.textContent = qty;
        subtotalEl.textContent = subtotal.toFixed(2);
        donationEl.textContent = donation.toFixed(2);
        shippingEl.textContent = shipping.toFixed(2);
        taxEl.textContent = salesTax.toFixed(2);
        paypalEl.textContent = paypalFee.toFixed(2);
        totalEl.textContent = total.toFixed(2);

        // Update the preview text area
        previewText.value = buildEmailBody(items, subtotal, donation, salesTax, shipping, paypalFee, total);
      }

      function buildEmailBody(items, subtotal, donation, salesTax, shipping, paypalFee, total) {
        const name = document.getElementById("customer-name").value.trim();
        const email = document.getElementById("customer-email").value.trim();
        const phone = document.getElementById("customer-phone").value.trim();
        const homeLodge = document.getElementById("home-lodge-number").value.trim();
        const shippingAddress = document.getElementById("shipping-address").value.trim();
        const shippingOption = document.querySelector('input[name="shipping-option"]:checked')?.value || "ship";

        let lines = [];

        lines.push("Elks Riders Leather Koozie Order");
        lines.push("================================");
        lines.push("");
        lines.push("Order date: " + new Date().toLocaleString());
        lines.push("");
        lines.push("Customer & Shipping Details");
        lines.push("---------------------------");
        lines.push("Customer name (person placing this order): " + (name || ""));
        lines.push("Email: " + (email || ""));
        if (phone) lines.push("Phone: " + phone);
        if (homeLodge) lines.push("Home Lodge Name & Number: " + homeLodge);
        lines.push("Shipping choice: " + (shippingOption === "ship" ? "Ship via USPS flat-rate" : "Local pickup / arrange with order coordinator"));
        if (shippingOption === "ship" && shippingAddress) {
          lines.push("Shipping address:");
          lines.push(shippingAddress);
        }

        lines.push("");
        lines.push("Koozie Details (" + items.length + " total)");
        lines.push("--------------------------------");
        items.forEach((item, index) => {
          lines.push("");
          lines.push("Koozie #" + (index + 1));
          lines.push("  Lodge #: " + (item.lodge || ""));
          lines.push("  Road name: " + (item.roadName || ""));
          let officerTitle = "";
          if (item.officer === "Other" && item.officerCustom) {
            officerTitle = item.officerCustom;
          } else if (item.officer) {
            officerTitle = item.officer;
          }
          if (officerTitle) lines.push("  Officer title: " + officerTitle);
          lines.push("  Founding Member: " + (item.founding ? "YES" : "No"));
        });

        lines.push("");
        lines.push("Pricing Summary");
        lines.push("---------------");
        lines.push("Quantity: " + items.length + " koozie(s)");
        lines.push("Subtotal (@ $35 each): $" + subtotal.toFixed(2));
        lines.push("Shipping: $" + shipping.toFixed(2));
        lines.push("Washington sales tax (items + shipping): $" + salesTax.toFixed(2));
        lines.push("PayPal processing fee (shipped orders only, not subject to sales tax): $" + paypalFee.toFixed(2));
        lines.push("Total to be invoiced: $" + total.toFixed(2));

        lines.push("");
        lines.push("Donation Information");
        lines.push("--------------------");
        lines.push("$10 from each koozie is donated to Forks Elks Riders #2524.");
        lines.push("Estimated donation for this order (included in item price): $" + donation.toFixed(2));

        lines.push("");
        lines.push("Payment Information");
        lines.push("-------------------");
        lines.push("For shipped orders, payment is collected by PayPal. The total above includes a PayPal processing fee of 2.9% + $0.30.");
        lines.push("Local pickup orders may be paid in cash and will not incur this PayPal fee.");
        lines.push("A PayPal invoice will be sent for $" + total.toFixed(2) + " once your order is ready to begin (for shipped orders).");
        lines.push("Please do not send any payment until you receive that invoice.");
        lines.push("The invoice will identify this as your Elks Riders leather koozie order.");
        lines.push("");
        lines.push("If you require more than 10 koozies, an additional order form may be submitted for the extra items.");

        lines.push("");
        lines.push("Privacy & Contact");
        lines.push("-----------------");
        lines.push("Your information is kept private and will never be shared or sold.");
        lines.push("You will only be contacted regarding this order.");
        lines.push("");
        lines.push("Thank you for supporting Forks Elks Riders #2524!");

        return lines.join("\n");
      }

      addKoozieBtn.addEventListener("click", addKoozie);

      document.addEventListener("change", (e) => {
        if (e.target.name === "shipping-option") {
          updateTotalsAndPreview();
        }
      });

      document.addEventListener("input", (e) => {
        if (
          e.target.closest(".koozie-item") ||
          e.target.id === "customer-name" ||
          e.target.id === "customer-email" ||
          e.target.id === "customer-phone" ||
          e.target.id === "home-lodge-number" ||
          e.target.id === "shipping-address"
        ) {
          updateTotalsAndPreview();
        }
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const items = getKoozieData();

        if (items.length === 0) {
          alert("Please add at least one koozie to your order.");
          return;
        }

        // Validate per-koozie required fields
        for (let i = 0; i < items.length; i++) {
          if (!items[i].lodge || !items[i].roadName) {
            alert("Koozie #" + (i + 1) + " is missing Lodge number or Road name.");
            return;
          }
        }

        const name = document.getElementById("customer-name").value.trim();
        const email = document.getElementById("customer-email").value.trim();
        const shippingAddress = document.getElementById("shipping-address").value.trim();
        const shippingOption = document.querySelector('input[name="shipping-option"]:checked')?.value || "ship";

        if (!name || !email) {
          alert("Please fill in your name and email.");
          return;
        }

        if (shippingOption === "ship" && !shippingAddress) {
          alert("Please enter a shipping address or choose local pickup.");
          return;
        }

        // Recompute totals to keep in sync
        const qty = items.length;
        const subtotal = qty * PRICE_PER_KOOZIE;
        const donation = qty * DONATION_PER_KOOZIE;
        const shipping = shippingOption === "ship" && qty > 0 ? SHIPPING_FLAT : 0;

        const taxableAmount = subtotal + shipping;
        const salesTax = taxableAmount > 0 ? taxableAmount * SALES_TAX_RATE : 0;

        let paypalFee = 0;
        if (shippingOption === "ship" && qty > 0) {
          paypalFee = subtotal * PAYPAL_PERCENT + PAYPAL_FIXED;
        }

        const total = subtotal + shipping + salesTax + paypalFee;

        const emailBody = buildEmailBody(items, subtotal, donation, salesTax, shipping, paypalFee, total);
        const subject = "Elks Riders Koozie Order - " + name + " (" + qty + " koozie(s))";

        // Update preview in case it isn't already
        previewText.value = emailBody;

        const mailtoLink =
          "mailto:" +
          encodeURIComponent(ORDER_EMAIL) +
          "?subject=" +
          encodeURIComponent(subject) +
          "&body=" +
          encodeURIComponent(emailBody);

        // Open default email client
        window.location.href = mailtoLink;
      });

      // Initialize with one koozie
      addKoozie();
    })();
  </script>
</body>
</html>
